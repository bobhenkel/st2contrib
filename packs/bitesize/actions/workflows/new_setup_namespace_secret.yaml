version: '2.0'
bitesize.new_setup_namespace_secret:
  description: generate a secret template and apply to a namespace
  type: direct
  input:
    - namespace
    - name
    - value
  tasks:
    create_ns_secret_template:
      action: bitesize.new_create_ns_secret_template
      input:
        namespace: <% $.namespace %>
        name: <% $.name %>
        value: <% $.value %>
      publish:
        secrettemplate: <% task(create_ns_secret_template).result.result %>
      on-success:
        - create_secret
    create_secret:
      action: kubernetes.createCoreV1NamespacedSecret
      input:
        namespace: <% $.namespace %>
        body: <% $.secrettemplate %>

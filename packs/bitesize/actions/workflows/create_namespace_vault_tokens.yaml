---
  chain:
    -
      name: "create_ns_vault_rule_read"
      ref: "bitesize.create_ns_vault_rule"
      parameters:
        namespace: "{{namespace}}"
        policy: "read"
      publish:
        rule_read: "{{create_ns_vault_rule_read.stdout}}"
      on-success: "create_token_read"
    -
      name: "create_token_read"
      ref: "vault.create_token"
      parameters:
        name: "{{namespace}}"
        acl_type: "client"
        rules: "{{rule_read}}"
      on-success: "create_ns_vault_rule_write"
    -
      name: "stash_read_token"
      ref: "kubernetes.create_secret"
      parameters:
        name: "vault-{{namespace}}-read"
        value: "{{create_token_read}}"
        ns: "{{namespace}}"
      on-success: "create_ns_vault_rule_write"
    -
      name: "create_ns_vault_rule_write"
      ref: "bitesize.create_ns_vault_rule"
      parameters:
        namespace: "{{namespace}}"
        policy: "write"
      publish:
        rule_write: "{{create_ns_vault_rule.stdout}}"
      on-success: "create_token_write"
    -
      name: "create_token_write"
      ref: "vault.create_token"
      parameters:
        name: "{{namespace}}"
        acl_type: "client"
        rules: "{{rule_write}}"
      on-success: "stash_write_token"
    -
      name: "stash_write_token"
      ref: "kubernetes.create_secret"
      parameters:
        name: "vault-{{namespace}}-write"
        value: "{{create_token_write}}"
        ns: "{{namespace}}"

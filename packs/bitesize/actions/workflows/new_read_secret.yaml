version: '2.0'
bitesize.new_read_secret:
  description: read and decode a secret from kubernetes
  type: direct
  input:
    - namespace
    - name
  tasks:
    get_secret:
      action: kubernetes.readCoreV1NamespacedSecret
      input:
        namespace: <% $.namespace %>
        name: <% $.name %>
      publish:
        encoded: <% task(get_secret).result.result.data.data.get($.name) %>
      on-success:
        decode_secret
    decode_secret:
      action: core.local
      input:
        cmd: echo <% $.encoded %> | base64 -d -
      publish:
        secret: <% task(decode_secret).result.stdout %>

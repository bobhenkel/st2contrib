---
  chain:
    -
      name: "pv_spec"
      ref: "bitesize.pv_spec"
      params:
        payload: "{{payload}}"
      on-success: "get_volsize"
    -
      name: "get_volsize"
      ref: "consul.get"
      parameters:
        key: "nfs/{{pv_spec.result.customer}}/volsize"
        recurse: False
      on-success: "get_host"
    -
      name: "get_host"
      ref: "consul.get"
      parameters:
        key: "nfs/{{pv_spec.result.customer}}/host"
        recurse: False
      on-success: "generate_pv_body"
    -
      name: "generate_pv_body"
      ref: "bitesize.generate_pv_body"
      params:
        volsize: "{{get_volsize.result.Value}}"
        host: "{{get_host.result.Value}}"
        payload: "{{payload}}"
      on-success: "create_persistent_volume"
    -
      name: "create_persistent_volume"
      ref: "kubernetes.createCoreV1PersistentVolume"
      params:
        body: "{{generate_pv_body.result.pvbody}}"
      on-success: "consul_put_pv_name"
    -
      name: "consul_put_pv_name"
      ref: "consul.put"
      parameters:
        key: "nfs/{{pv_spec.result.customer}}/pvs/{{pv_spec.result.pvcname}}"
        value: "{{pv_spec.result.pvcname}}"
